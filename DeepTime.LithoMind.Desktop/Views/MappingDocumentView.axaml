<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:DeepTime.LithoMind.Desktop.ViewModels.Pages"
             x:Class="DeepTime.LithoMind.Desktop.Views.MappingDocumentView"
             x:DataType="vm:MappingDocumentViewModelBase">

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- é¡¶éƒ¨å·¥å…·æ  -->
        <Border Grid.Row="0" Background="#2C3E50" Padding="8">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- å·¦ä¾§æ ‡é¢˜ -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="{Binding IconKey}" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding ChartTitle}" FontSize="14" Foreground="White" FontWeight="Bold" VerticalAlignment="Center"/>
                    <TextBlock Text="-" FontSize="14" Foreground="#7F8C8D" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding ChartSubtitle}" FontSize="12" Foreground="#3498DB" VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- å³ä¾§å·¥å…·æŒ‰é’® -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
                    <!-- æ”¾å¤§æŒ‰é’® -->
                    <Button Content="ðŸ”+" 
                            ToolTip.Tip="æ”¾å¤§"
                            Command="{Binding ZoomInCommand}"
                            Background="Transparent"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="8,4"
                            Cursor="Hand"/>
                    <!-- ç¼©æ”¾æ¯”ä¾‹æ˜¾ç¤º -->
                    <Border Background="#34495E" CornerRadius="4" Padding="8,4" VerticalAlignment="Center">
                        <TextBlock Text="{Binding ZoomLevelText}" 
                                   FontSize="12" 
                                   Foreground="White"
                                   MinWidth="45"
                                   TextAlignment="Center"/>
                    </Border>
                    <!-- ç¼©å°æŒ‰é’® -->
                    <Button Content="ðŸ”-" 
                            ToolTip.Tip="ç¼©å°"
                            Command="{Binding ZoomOutCommand}"
                            Background="Transparent"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="8,4"
                            Cursor="Hand"/>
                    <!-- åˆ†éš”çº¿ -->
                    <Border Width="1" Background="#7F8C8D" Margin="4,2"/>
                    <!-- é‡ç½®ç¼©æ”¾æŒ‰é’® -->
                    <Button Content="ðŸŽ¯" 
                            ToolTip.Tip="é‡ç½®è§†å›¾"
                            Command="{Binding ResetZoomCommand}"
                            Background="Transparent"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="8,4"
                            Cursor="Hand"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- ä¸»å†…å®¹åŒº - åœ°å›¾æ˜¾ç¤ºï¼ˆç¦ç”¨æ»šåŠ¨ï¼Œä½¿ç”¨è‡ªå®šä¹‰ç¼©æ”¾ï¼‰ -->
        <Border Grid.Row="1" Background="#1a1a2e" ClipToBounds="True" x:Name="MapContainer">
            <Grid>
                <Grid HorizontalAlignment="Center" VerticalAlignment="Center" MinWidth="400">
                    <!-- æ— å›¾ç‰‡æç¤º -->
                    <StackPanel IsVisible="{Binding !HasImage}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center">
                        <TextBlock Text="{Binding IconKey}" FontSize="60" HorizontalAlignment="Center" Foreground="White"/>
                        <TextBlock Text="{Binding Title}" FontSize="18" Foreground="White" HorizontalAlignment="Center" Margin="0,15,0,0"/>
                        <TextBlock Text="åŠ è½½åœ°å›¾æ•°æ®..." FontSize="14" Foreground="#7F8C8D" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                    </StackPanel>
                    
                    <!-- åœ°å›¾å›¾ç‰‡ - å±…ä¸­æ˜¾ç¤ºï¼Œæ»šè½®æŽ§åˆ¶ç¼©æ”¾ -->
                    <Image Source="{Binding MapImage}"
                           IsVisible="{Binding HasImage}"
                           Stretch="None"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center">
                        <Image.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform ScaleX="{Binding ZoomLevel}" 
                                               ScaleY="{Binding ZoomLevel}"/>
                                <TranslateTransform X="{Binding PanOffsetX}"
                                                   Y="{Binding PanOffsetY}"/>
                            </TransformGroup>
                        </Image.RenderTransform>
                    </Image>
                </Grid>
                
                <!-- æ‚¬æµ®å›¾ä¾‹çª—å£ - å›ºå®šåœ¨å³ä¸‹è§’ -->
                <Border x:Name="LegendPanel"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom"
                        Margin="0,0,20,20"
                        Background="#F5F5F5"
                        BorderBrush="#2C3E50"
                        BorderThickness="1"
                        CornerRadius="6"
                        MinWidth="160"
                        MaxWidth="220"
                        IsVisible="{Binding HasImage}">
                    <Border.Opacity>
                        <Binding Path="LegendOpacity">
                            <Binding.Converter>
                                <vm:PercentToOpacityConverter/>
                            </Binding.Converter>
                        </Binding>
                    </Border.Opacity>
                    <Grid RowDefinitions="Auto,Auto,Auto">
                        <!-- å›¾ä¾‹æ ‡é¢˜æ ï¼ˆå¯æ‹–æ‹½ï¼‰ -->
                        <Border Grid.Row="0" 
                                x:Name="LegendTitleBar"
                                Background="#2C3E50" 
                                CornerRadius="6,6,0,0"
                                Padding="10,6"
                                Cursor="Hand">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" 
                                           Text="{Binding LegendTitle}" 
                                           FontSize="12" 
                                           FontWeight="Bold"
                                           Foreground="White"
                                           VerticalAlignment="Center"/>
                                <Button Grid.Column="1" 
                                        Content="{Binding IsLegendExpanded, Converter={x:Static vm:BoolToExpandIconConverter.Instance}}"
                                        Command="{Binding ToggleLegendCommand}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Foreground="White"
                                        FontSize="10"
                                        Padding="4,2"
                                        Cursor="Hand"
                                        ToolTip.Tip="å±•å¼€/æ”¶èµ·å›¾ä¾‹"/>
                            </Grid>
                        </Border>
                        
                        <!-- å›¾ä¾‹å†…å®¹ -->
                        <Border Grid.Row="1" 
                                IsVisible="{Binding IsLegendExpanded}"
                                Padding="8,6"
                                Background="White">
                            <ItemsControl ItemsSource="{Binding LegendItems}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="20,*" Margin="0,3">
                                            <!-- é¢œè‰²æ¡† -->
                                            <Border Grid.Column="0"
                                                    Width="16" Height="16"
                                                    CornerRadius="2"
                                                    BorderBrush="#7F8C8D"
                                                    BorderThickness="0.5">
                                                <Border.Background>
                                                    <SolidColorBrush Color="{Binding Color}"/>
                                                </Border.Background>
                                            </Border>
                                            <!-- æ ‡ç­¾ -->
                                            <TextBlock Grid.Column="1" 
                                                       Text="{Binding Label}" 
                                                       FontSize="11" 
                                                       Foreground="#2C3E50"
                                                       VerticalAlignment="Center"
                                                       Margin="6,0,0,0"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Border>
                        
                        <!-- é€æ˜Žåº¦æ»‘å— -->
                        <Border Grid.Row="2" 
                                IsVisible="{Binding IsLegendExpanded}"
                                Padding="8,4"
                                Background="#ECEFF1"
                                CornerRadius="0,0,6,6">
                            <Grid ColumnDefinitions="Auto,*,Auto">
                                <TextBlock Grid.Column="0" Text="é€æ˜Žåº¦:" FontSize="10" Foreground="#7F8C8D" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" 
                                        Minimum="30" Maximum="100" 
                                        Value="{Binding LegendOpacity}"
                                        Margin="6,0"/>
                                <TextBlock Grid.Column="2" 
                                           Text="{Binding LegendOpacity, StringFormat={}{0}%}" 
                                           FontSize="10" 
                                           Foreground="#7F8C8D" 
                                           VerticalAlignment="Center"
                                           MinWidth="30"/>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Border>
        
        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <Border Grid.Row="2" Background="#ECF0F1" Padding="8,6">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="15">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="åæ ‡:" FontSize="11" Foreground="#7F8C8D"/>
                        <TextBlock Text="{Binding CoordinateInfo}" FontSize="11" Foreground="#2C3E50" FontWeight="SemiBold"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="æ¯”ä¾‹å°º:" FontSize="11" Foreground="#7F8C8D"/>
                        <TextBlock Text="{Binding ScaleInfo}" FontSize="11" Foreground="#2C3E50"/>
                    </StackPanel>
                </StackPanel>
                <TextBlock Grid.Column="2" 
                           Text="æ»šè½®ç¼©æ”¾ | æ‹–æ‹½å¹³ç§»" 
                           FontSize="10" 
                           Foreground="#95A5A6"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
