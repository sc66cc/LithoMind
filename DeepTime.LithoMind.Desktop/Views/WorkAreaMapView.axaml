<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:DeepTime.LithoMind.Desktop.ViewModels.Pages"
             x:Class="DeepTime.LithoMind.Desktop.Views.WorkAreaMapView"
             x:DataType="vm:WorkAreaMapViewModel">
    
    <Grid RowDefinitions="Auto,*,Auto">
        <!-- é¡¶éƒ¨å·¥å…·æ  -->
        <Border Grid.Row="0" Background="#2C3E50" Padding="8">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- å·¦ä¾§æ ‡é¢˜ -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="ðŸ—ºï¸" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="å·¥åŒºå¹³é¢å›¾" FontSize="14" Foreground="White" FontWeight="Bold" VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- å³ä¾§å·¥å…·æŒ‰é’® -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
                    <!-- æ”¾å¤§æŒ‰é’® -->
                    <Button Content="ðŸ”+" 
                            ToolTip.Tip="æ”¾å¤§ (Ctrl+æ»šè½®å‘ä¸Š)"
                            Command="{Binding ZoomInCommand}"
                            Background="Transparent"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="8,4"
                            Cursor="Hand"/>
                    <!-- ç¼©æ”¾æ¯”ä¾‹æ˜¾ç¤º -->
                    <Border Background="#34495E" CornerRadius="4" Padding="8,4" VerticalAlignment="Center">
                        <TextBlock Text="{Binding ZoomLevelText}" 
                                   FontSize="12" 
                                   Foreground="White"
                                   MinWidth="45"
                                   TextAlignment="Center"/>
                    </Border>
                    <!-- ç¼©å°æŒ‰é’® -->
                    <Button Content="ðŸ”-" 
                            ToolTip.Tip="ç¼©å° (Ctrl+æ»šè½®å‘ä¸‹)"
                            Command="{Binding ZoomOutCommand}"
                            Background="Transparent"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="8,4"
                            Cursor="Hand"/>
                    <!-- åˆ†éš”çº¿ -->
                    <Border Width="1" Background="#7F8C8D" Margin="4,2"/>
                    <!-- é‡ç½®ç¼©æ”¾æŒ‰é’® -->
                    <Button Content="ðŸŽ¯" 
                            ToolTip.Tip="é‡ç½®è§†å›¾ (1:1)"
                            Command="{Binding ResetZoomCommand}"
                            Background="Transparent"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="8,4"
                            Cursor="Hand"/>
                    <!-- é€‚åº”çª—å£æŒ‰é’® -->
                    <Button Content="â¬œ" 
                            ToolTip.Tip="é€‚åº”çª—å£å¤§å°"
                            Command="{Binding FitToWindowCommand}"
                            Background="Transparent"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="8,4"
                            Cursor="Hand"/>
                    <!-- åˆ·æ–°æŒ‰é’® -->
                    <Button Content="ðŸ”„" 
                            ToolTip.Tip="åˆ·æ–°åœ°å›¾"
                            Command="{Binding RefreshMapCommand}"
                            Background="Transparent"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="8,4"
                            Cursor="Hand"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- åœ°å›¾æ˜¾ç¤ºåŒºåŸŸ -->
        <Border Grid.Row="1" Background="#F5F5F5" ClipToBounds="True">
            <Grid>
                <!-- åŠ è½½ä¸­æç¤º -->
                <StackPanel IsVisible="{Binding IsLoading}"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center">
                    <TextBlock Text="â³" FontSize="48" HorizontalAlignment="Center"/>
                    <TextBlock Text="æ­£åœ¨åŠ è½½å·¥åŒºå¹³é¢å›¾..." 
                               FontSize="14" 
                               Foreground="#7F8C8D"
                               Margin="0,10,0,0"/>
                </StackPanel>
                
                <!-- é”™è¯¯æç¤º -->
                <StackPanel IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center">
                    <TextBlock Text="âš ï¸" FontSize="48" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding ErrorMessage}" 
                               FontSize="14" 
                               Foreground="#E74C3C"
                               Margin="0,10,0,0"
                               TextWrapping="Wrap"
                               MaxWidth="400"
                               TextAlignment="Center"/>
                    <Button Content="é‡æ–°åŠ è½½" 
                            Command="{Binding RefreshMapCommand}"
                            HorizontalAlignment="Center"
                            Margin="0,15,0,0"
                            Padding="15,8"
                            Background="#3498DB"
                            Foreground="White"/>
                </StackPanel>
                
                <!-- åœ°å›¾ç”»å¸ƒ - æ”¯æŒç¼©æ”¾å’Œæ‹–æ‹½ -->
                <Canvas x:Name="MapCanvas"
                        IsVisible="{Binding IsImageLoaded}"
                        Background="Transparent"
                        ClipToBounds="True">
                    <Image x:Name="MapImage"
                           Source="{Binding MapImage}"
                           Stretch="None"
                           RenderTransformOrigin="0,0">
                        <Image.RenderTransform>
                            <TransformGroup>
                                <ScaleTransform ScaleX="{Binding ZoomLevel}" 
                                               ScaleY="{Binding ZoomLevel}"/>
                                <TranslateTransform X="{Binding PanOffsetX}"
                                                   Y="{Binding PanOffsetY}"/>
                            </TransformGroup>
                        </Image.RenderTransform>
                    </Image>
                </Canvas>
            </Grid>
        </Border>
        
        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <Border Grid.Row="2" Background="#ECF0F1" Padding="8,6">
            <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                <!-- å›¾åƒä¿¡æ¯ -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="15">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="å°ºå¯¸:" FontSize="11" Foreground="#7F8C8D"/>
                        <TextBlock FontSize="11" Foreground="#2C3E50">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} Ã— {1} px">
                                    <Binding Path="ImageWidth"/>
                                    <Binding Path="ImageHeight"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="ç¼©æ”¾:" FontSize="11" Foreground="#7F8C8D"/>
                        <TextBlock Text="{Binding ZoomLevelText}" FontSize="11" Foreground="#2C3E50"/>
                    </StackPanel>
                </StackPanel>
                
                <!-- æ“ä½œæç¤º -->
                <TextBlock Grid.Column="3" 
                           Text="æ»šè½®ç¼©æ”¾ | æ‹–æ‹½å¹³ç§»" 
                           FontSize="10" 
                           Foreground="#95A5A6"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
